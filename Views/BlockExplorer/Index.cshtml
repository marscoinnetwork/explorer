@model dynamic
@{
   ViewBag.Title = "Block Explorer";
   Layout = "_Layout";
}
@section Style
{
   <style>
      #crafted {
         position: relative;
         color: #111111;
      }
   </style>
}
<partial name="SearchBlock" />
<section class="block-explorer-section section bg-bottom">
   <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="center-heading">
                    <h2 class="section-title">Block Time</h2>
                </div>
                <div id="echart" style="height: 300px"></div>
            </div>
        </div>

      <div class="row">
         <div class="col-lg-12">
            <div class="center-heading">
               <h2 class="section-title">Latest Blocks</h2>
            </div>
         </div>
      </div>
      <div class="row">
         <div class="col-lg-12">

            <div class="table-responsive">
               <table class="table table-striped table-latests">
                  <thead>
                     <tr>
                        <td>Block Height</td>
                        <td>Age</td>
                        <td>Transactions</td>
                        <td>Size</td>
                        @*<td>Block Hash</td>*@
                     </tr>
                  </thead>
                  <tbody>
                     @if (ViewBag.Blocks != null)
                     {
                        foreach (var block in ViewBag.Blocks)
                        {
                           <tr>
                              <td><a asp-controller="BlockExplorer" asp-action="Block" asp-route-block="@block.BlockIndex">@block.BlockIndex</a></td>
                              <td><time since="@DateTime.Now">@block.BlockTime</time></td>
                              <td>@block.TransactionCount</td>
                              <td>@block.BlockSize bytes</td>
                              @*<td><a asp-controller="BlockExplorer" asp-action="BlockHash" asp-route-hash="@block.BlockHash">@block.BlockHash</a></td>*@
                           </tr>
                        }
                     }
                  </tbody>
               </table>
            </div>
                <a href="https://www.xouranos.com/" target="_blank" class="btn-white-line"><i class="fas fa-globe"></i> Prev</a>
                <a href="https://www.xouranos.com/" target="_blank" class="btn-white-line"><i class="fas fa-globe"></i> Next</a>

            @if (ViewBag.Error != null)
            {
               <p>@ViewBag.Error</p>
            }

         </div>
      </div>
   </div>
</section>

<script type="text/javascript">
    var hashrate = [];
    var difficulty = [];
    $(document).ready(function () {

        var dom = document.getElementById('echart');
        var myChart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var app = {};

        var option;

        // prettier-ignore
        hashrate = [];
        const dateList = [];
        const valueList = [];
        option = {
            // Make gradient line here
            visualMap: [
                {
                    type: 'continuous',
                }
            ],
            title: [
                {
                    left: 'center',
                    text: 'Last 30 blocks'
                }
            ],
            tooltip: {
                trigger: 'axis'
            },
            xAxis: [
                {
                    data: dateList,
                    axisLabel: {
                        show: true,
                        rotate: 60,
                    }
                }
            ],
            yAxis: [
                {}
            ],
            series: [
                {
                    type: 'line',
                    showSymbol: false,
                    data: valueList
                }
            ]
        };

        if (option && typeof option === 'object') {
            myChart.setOption(option);
        }

        window.addEventListener('resize', myChart.resize);

        loadnetstatshashrate();
        setInterval(loadnetstatshashrate, 1000 * 60);
        function loadnetstatshashrate() {
            $.ajax({
                url: "/block-explorer/netstatsblocktime",
                success: function (res) {
                    option.xAxis[0].data = res.x;
                    option.series[0].data = res.y;
                    option.title[0].text = "Last 30 blocks (avg block time "+res.avg+"s)";
                    myChart.setOption(option);
                }
            });
        }

    });


</script>
